# Report Formats

Threat Thinker emits multiple report formats so you can review findings and feed them into automation. Think runs produce Markdown/JSON/HTML; diff runs produce Markdown/JSON. Filenames are derived from the diagram name (e.g., `system_report.md/json/html`) unless overridden with `--out-name`.

## Markdown (.md)
- **Purpose:** Human-readable summary for quick review or sharing in PRs.
- **Contents:** Threat summary table (ID, title, severity, score) plus per-threat sections with STRIDE categories, affected components, rationale, references, and recommended actions.
- **Best for:** Pull requests, lightweight reviews, and copying excerpts into tickets.

## JSON (.json)
- **Purpose:** Machine-readable output for pipelines, regressions, and diffing.
- **Contents:**
  - `generated_at`, `count`, and `threats` array with `id`, `title`, `stride`, `severity`, `score`, `affected`, `why`, `recommended_action`, `references`, `evidence.nodes`, `evidence.edges`, and `confidence`.
  - Optional `import_metrics` (diagram parse stats) and `graph` (nodes/edges with zones, types, protocols, data tags).
- **Best for:** Automation, storing history, and driving `threat-thinker diff` between versions.

## HTML (.html)
- **Purpose:** Shareable rich report with the same content as Markdown plus evidence mapping.
- **Contents:** Mirrors the Markdown threats list and includes architecture context when the graph is available (node/edge IDs resolved to labels/zones/types/protocols).
- **Best for:** Stakeholder readouts and situations where hyperlinks/formatting help (e.g., attaching to Confluence/Wikis).

## Threat Dragon (.threat-dragon.json)
- **When emitted:** Only when the input diagram was Threat Dragon JSON (v2.x). Mermaid/Draw.io/Image inputs do not generate this output.
- **Purpose:** Round-trip back to Threat Dragon while preserving the original layout and cell data.
- **Contents:** Original Threat Dragon model with nodes/flows unchanged, plus detected threats embedded into the corresponding cell `data.threats` (or diagram-level `threats`), and `hasOpenThreats` set when applicable. Layout (position/size/ports/vertices) is not regenerated.
- **Filenames:** Uses the same basename as other reports with the suffix `.threat-dragon.json` (e.g., `system_report.threat-dragon.json`).

## Diff Outputs (Markdown / JSON)
Generated by `threat-thinker diff` when comparing two JSON reports (before/after).

- **Purpose:** Explain how the system and threat model changed between two versions.
- **Contents:** Includes metadata (`before_file`, `after_file`, `generated_at`), graph changes (added/removed/changed nodes and edges), threat changes (added/removed/changed threats with field-level diffs), and an LLM-written narrative explanation.
- **Best for:** Regression reviews, change impact analysis, and gating deployments on threat model deltas.
- **Filenames:** Derived from the `--after` JSON (e.g., `system_report_diff.md/json`) unless `--out-name` is set.

## JSON Structure (top-level)
Think report (JSON):
```json
{
  "generated_at": "...",
  "count": 5,
  "threats": [
    {
      "id": "T001",
      "title": "...",
      "stride": [],
      "severity": "High",
      "score": 8.0,
      "affected": [],
      "why": "...",
      "recommended_action": "...",
      "references": [],
      "evidence": { "nodes": [], "edges": [] },
      "confidence": 0.0
    }
  ],
  "import_metrics": {...},
  "graph": { "nodes": [...], "edges": [...] }
}
```

Diff report (JSON):
```json
{
  "generated_at": "...",
  "before_file": "...",
  "after_file": "...",
  "graph_changes": { "nodes_added": [], "nodes_removed": [], "edges_added": [], "edges_removed": [], "nodes_changed": [] },
  "threat_changes": { "added": [], "removed": [], "changed": [] },
  "explanation": "LLM-written narrative"
}
```

## Where Reports Are Saved
- CLI: use `--out-dir` to set the target folder; add `--out-name` to change the basename.
- Web UI: reports are written to a temporary path; download from the UI after generation.

## Related Commands
- Generate reports: `threat-thinker think --mermaid diagram.mmd --infer-hints --llm-api openai --llm-model gpt-4.1 --out-dir reports/`
- Diff two runs: `threat-thinker diff --after reports/new-report.json --before reports/old-report.json --llm-api openai --llm-model gpt-4.1 --out-dir reports/ --lang en`
